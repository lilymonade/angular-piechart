"use strict";var ngPieChart=angular.module("ngPieChart",[]);ngPieChart.directive("ngpiechart",["$timeout",function(e){return{restrict:"E",require:"?ngModel",scope:{progression:"=",total:"=",onStart:"=",onStep:"=",onStop:"="},transclude:!0,link:function(t,n,a){var i=["butt","round","square"],r=100;"number"!=typeof parseFloat(t.total)||isNaN(parseFloat(t.total))||(r=parseFloat(t.total));var o={barColor:"#ef1e25",trackColor:"#f2f2f2",scaleColor:"#dfe0e0",scaleLength:5,lineCap:"butt",lineWidth:3,size:110,rotate:0,animate:{duration:1e3,enabled:!0}},s={};a.$observe("barColor",function(e){"string"==typeof e&&""!==e.trim()&&(s.barColor=e.trim())}),a.$observe("trackColor",function(e){"string"==typeof e&&"false"===e.trim()?s.trackColor=!1:"string"==typeof e&&""!==e.trim()&&"true"!==e.trim()&&(s.trackColor=e.trim())}),a.$observe("scaleColor",function(e){"string"==typeof e&&"false"===e.trim()?s.scaleColor=!1:"string"==typeof e&&""!==e.trim()&&"true"!==e.trim()&&(s.scaleColor=e.trim())}),a.$observe("scaleLength",function(e){"number"!=typeof parseInt(e.trim())||isNaN(parseInt(e.trim()))||(s.scaleLength=parseInt(e.trim()))}),a.$observe("lineCap",function(e){"string"==typeof e&&i.indexOf(e.trim())>=0&&(s.lineCap=e.trim())}),a.$observe("lineWidth",function(e){"number"!=typeof parseInt(e.trim())||isNaN(parseInt(e.trim()))||(s.lineWidth=parseInt(e.trim()))}),a.$observe("size",function(e){"number"!=typeof parseInt(e.trim())||isNaN(parseInt(e.trim()))||(s.size=parseInt(e.trim()))}),a.$observe("rotate",function(e){"number"!=typeof parseInt(e.trim())||isNaN(parseInt(e.trim()))||(s.rotate=parseInt(e.trim()))}),a.$observe("animate",function(e){("true"===e.trim()||"false"===e.trim())&&(s.animate={enabled:"true"===e.trim(),duration:o.animate.duration},s.animate.enabled&&a.$observe("animateDuration",function(e){"number"!=typeof parseInt(e.trim())||isNaN(parseInt(e.trim()))||(s.animate.duration=parseInt(e.trim()))}))}),e(function(){t.$watch(function(){return s},function(e){angular.extend(o,e),n.addClass("ngPieChart").css("width",o.size+"px").css("height",o.size+"px");var a=n.find("div.chart-content");a[0]&&a.css("width",o.size-2*o.lineWidth+"px").css("height",o.size-2*o.lineWidth+"px").css("top",o.lineWidth+"px").css("left",o.lineWidth+"px"),o.animate.enabled&&("function"==typeof t.onStart&&(o.onStart=t.onStart),"function"==typeof t.onStep&&(o.onStep=t.onStep),"function"==typeof t.onStop&&(o.onStop=t.onStop));var i=new NgPieChart(n[0],o);t.$watch("progression",function(){var e=0;"number"!=typeof parseFloat(t.progression)||isNaN(parseFloat(t.progression))||(e=parseFloat(t.progression)<=r?parseFloat(t.progression):r);var n=e/r*100;i.update(n)})},!0)})},template:'<div class="chart-content"><div class="chart-data" ng-transclude></div></div>'}}]);var CanvasRenderer=function(e,t){var n,a=document.createElement("canvas");e.appendChild(a),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a);var i=a.getContext("2d");a.width=a.height=t.size;var r=1;window.devicePixelRatio>1&&(r=window.devicePixelRatio,a.style.width=a.style.height=[t.size,"px"].join(""),a.width=a.height=t.size*r,i.scale(r,r)),i.translate(t.size/2,t.size/2),i.rotate((-0.5+t.rotate/180)*Math.PI);var o=(t.size-t.lineWidth)/2;t.scaleColor&&t.scaleLength&&(o-=t.scaleLength+2),Date.now=Date.now||function(){return+new Date};var s=function(e,t,n){n=Math.min(Math.max(-1,n||0),1);var a=0>=n?!0:!1;i.beginPath(),i.arc(0,0,o,0,2*Math.PI*n,a),i.strokeStyle=e,i.lineWidth=t,i.stroke()},l=function(){var e,n;i.lineWidth=1,i.fillStyle=t.scaleColor,i.save();for(var a=24;a>0;--a)a%6===0?(n=t.scaleLength,e=0):(n=.6*t.scaleLength,e=t.scaleLength-n),i.fillRect(-t.size/2+e,0,n,1),i.rotate(Math.PI/12);i.restore()},d=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),u=function(){t.scaleColor&&l(),t.trackColor&&s(t.trackColor,t.trackWidth||t.lineWidth,1)};this.getCanvas=function(){return a},this.getCtx=function(){return i},this.clear=function(){i.clearRect(t.size/-2,t.size/-2,t.size,t.size)},this.draw=function(e){t.scaleColor||t.trackColor?i.getImageData&&i.putImageData?n?i.putImageData(n,0,0):(u(),n=i.getImageData(0,0,t.size*r,t.size*r)):(this.clear(),u()):this.clear(),i.lineCap=t.lineCap;var a;a="function"==typeof t.barColor?t.barColor(e):t.barColor,s(a,t.lineWidth,e/100)}.bind(this),this.animate=function(e,n){var a=Date.now();t.onStart(e,n);var i=function(){var r=Math.min(Date.now()-a,t.animate.duration),o=t.easing(this,r,e,n-e,t.animate.duration);this.draw(o),t.onStep(e,n,o),r>=t.animate.duration?t.onStop(e,n):d(i)}.bind(this);d(i)}.bind(this)},NgPieChart=function(e,t){var n={barColor:"#ef1e25",trackColor:"#f9f9f9",scaleColor:"#dfe0e0",scaleLength:5,lineCap:"round",lineWidth:3,trackWidth:void 0,size:110,rotate:0,animate:{duration:1e3,enabled:!0},easing:function(e,t,n,a,i){return t/=i/2,1>t?a/2*t*t+n:-a/2*(--t*(t-2)-1)+n},onStart:function(){},onStep:function(){},onStop:function(){}};if("undefined"!=typeof CanvasRenderer)n.renderer=CanvasRenderer;else{if("undefined"==typeof SVGRenderer)throw new Error("Please load either the SVG- or the CanvasRenderer");n.renderer=SVGRenderer}var a={},i=0,r=function(){this.el=e,this.options=a;for(var r in n)n.hasOwnProperty(r)&&(a[r]=t&&"undefined"!=typeof t[r]?t[r]:n[r],"function"==typeof a[r]&&(a[r]=a[r].bind(this)));a.easing="string"==typeof a.easing&&"undefined"!=typeof jQuery&&jQuery.isFunction(jQuery.easing[a.easing])?jQuery.easing[a.easing]:n.easing,"number"==typeof a.animate&&(a.animate={duration:a.animate,enabled:!0}),"boolean"!=typeof a.animate||a.animate||(a.animate={duration:1e3,enabled:a.animate}),this.renderer=new a.renderer(e,a),this.renderer.draw(i),e.dataset&&e.dataset.percent?this.update(parseFloat(e.dataset.percent)):e.getAttribute&&e.getAttribute("data-percent")&&this.update(parseFloat(e.getAttribute("data-percent")))}.bind(this);this.update=function(e){return e=parseFloat(e),a.animate.enabled?this.renderer.animate(i,e):this.renderer.draw(e),i=e,this}.bind(this),this.disableAnimation=function(){return a.animate.enabled=!1,this},this.enableAnimation=function(){return a.animate.enabled=!0,this},r()};